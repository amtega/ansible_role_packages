---
# Role variables

packages_os_process_required: >-
  {{ packages_os.keys() | list | length > 0
     or packages_os_hostvars | default([]) | length > 0
     or packages_python_process_required
     or packages_os_force | bool }}

packages_python_process_required: >-
  {{ packages_python.keys() | list | length > 0
     or packages_python_hostvars | default([]) | length > 0
     or packages_python_force | bool }}

packages_disable_plugin_value: >-
  {{ (packages_disable_plugins is undefined
      or packages_disable_plugins | length == 0)
      | ternary(omit, packages_disable_plugins | join(',')) }}
packages_enable_plugin_value: >-
  {{ (packages_enable_plugins is undefined
      or packages_enable_plugins | length == 0)
      | ternary(omit, packages_enable_plugins | join(',')) }}

packages_tmp_dir_environment:
  TMPDIR: "{{ packages_tmp_dir }}"

packages_python_source_filename: >-
  {{ packages_python_source_url | urlsplit("path") | basename }}

packages_python_source_full_path: >-
  {{ packages_python_source_compile_dir }}/{{ packages_python_source_filename }}

packages_python_source_dir: >-
  {{ packages_python_source_full_path
     | splitext
     | first }}

packages_python_source_version: >-
  {{ packages_python_source_filename
     | splitext
     | first
     | regex_replace(".*-([0-9]+\.[0-9]+\.[0-9]+)", "\1") }}

packages_python_source_version_major_minor: >-
  {{ packages_python_source_version.split(".")[0:2] | join(".") }}

packages_python_source_binary: >-
  {{ packages_python_source_install_dir
     + "/bin/python"
     +  packages_python_source_version_major_minor }}

packages_environment: >-
  {{ proxy_client_environment
     | default({})
     | combine(packages_tmp_dir_environment) }}

# Workaround to avoid false linter positive

packages_pipe: "|"

packages_os_exclude_pattern: >-
  {{ "^packages_os_("
      + "load_from_hostvars"
      + packages_pipe
      + "process_result"
      + packages_pipe
      + "setup_result"
      + packages_pipe
      + "result)$" }}

packages_python_exclude_pattern: >-
  {{ "^packages_python_("
      + "load_from_hostvars"
      + packages_pipe
      + "virtualenv"
      + packages_pipe
      + "extra_args"
      + packages_pipe
      + "set_ansible_interpreter"
      + packages_pipe
      + "bin_dir"
      + packages_pipe
      + "process_result"
      + packages_pipe
      + "setup_result"
      + packages_pipe
      + "source_binary_check_result"
      + packages_pipe
      + "result).*$" }}